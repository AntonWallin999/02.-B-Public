<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<title>Markdown Viewer – Obsidian-stil</title>

<!-- Lägg ev. Obsidian-exporterad CSS här -->
<link rel="stylesheet" href="obsidian.css">

<style>
body {
  margin: 0;
  padding: 2rem;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
}
</style>
</head>

<body>

<!-- ===============================
     RENDERINGSYTA (ENDA VYN)
     =============================== -->
<div class="markdown-preview-view markdown-rendered" id="obsidian-content">
Laddar…
</div>

<!-- ===============================
     MARKDOWN → HTML → RENDER
     =============================== -->
<script>
/* ============================================================
   KONFIGURATION (ENDA SANNINGEN)
   ============================================================ */

const GITHUB_RAW_BASE =
  "https://raw.githubusercontent.com/Allfaxcreation/Test/main/Index-B-gitt";

const START_FILE = "/Index-B-gitt.md";

/* ============================================================
   FETCH (DATASOURCE)
   ============================================================ */

function fetchMarkdown(path) {
  return fetch(GITHUB_RAW_BASE + path)
    .then(r => {
      if (!r.ok) throw new Error("Kunde inte hämta " + path);
      return r.text();
    });
}

/* ============================================================
   MARKDOWN → HTML (MINIMAL, TILLRÄCKLIG)
   ============================================================ */

function markdownToHtml(md) {
  let html = md;

  /* Rubriker */
  html = html.replace(/^###### (.*)$/gm, "<h6>$1</h6>");
  html = html.replace(/^##### (.*)$/gm, "<h5>$1</h5>");
  html = html.replace(/^#### (.*)$/gm, "<h4>$1</h4>");
  html = html.replace(/^### (.*)$/gm, "<h3>$1</h3>");
  html = html.replace(/^## (.*)$/gm, "<h2>$1</h2>");
  html = html.replace(/^# (.*)$/gm, "<h1>$1</h1>");

  /* Wiki-länkar [[fil]] eller [[fil|alias]] */
  html = html.replace(
    /\[\[([^\]|]+)(\|([^\]]+))?\]\]/g,
    function(_, target, __, alias) {
      return (
        '<a href="#" class="internal-link" data-href="' +
        target.trim() + '">' +
        (alias || target) +
        "</a>"
      );
    }
  );

  /* Listor */
  html = html.replace(/^- (.*)$/gm, "<li>$1</li>");
  html = html.replace(/(<li>.*<\/li>)/gs, "<ul>$1</ul>");

  /* Paragrafer */
  html = html.replace(
    /^(?!<h|<ul|<li|<div|<p)(.+)$/gm,
    "<p>$1</p>"
  );

  return html;
}

/* ============================================================
   RENDERING (ENDA FLÖDET)
   ============================================================ */

function loadMarkdown(path) {
  fetchMarkdown(path)
    .then(md => {
      document.getElementById("obsidian-content").innerHTML =
        markdownToHtml(md);
    })
    .catch(err => {
      document.getElementById("obsidian-content").innerHTML =
        "<p>Fel: " + err.message + "</p>";
    });
}

/* ============================================================
   INTERN NAVIGATION (INGA EXTERNA LÄNKAR)
   ============================================================ */

document.addEventListener("click", function(e) {
  const link = e.target.closest(".internal-link");
  if (!link) return;

  e.preventDefault();
  const target = link.getAttribute("data-href");
  loadMarkdown("/" + target + ".md");
});

/* ============================================================
   START (ROT-FILEN)
   ============================================================ */

loadMarkdown(START_FILE);
</script>

</body>
</html>
